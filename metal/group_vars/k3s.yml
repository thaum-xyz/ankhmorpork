---
k3s_version: v1.25.1-rc1+k3s1
k3s_master_ip: "{{ hostvars[groups['k3s_control_plane'][0]]['ansible_default_ipv4']['address'] }}"

k3s_server_config:
  disable:
  - servicelb
  - traefik
  - local-storage
  disable-cloud-controller: "true"
  kubelet-arg:
  - "system-reserved=cpu=100m,memory=200Mi"
  - "kube-reserved=cpu=100m,memory=300Mi"
  kube-controller-manager-arg:
  - "bind-address={{ k3s_master_ip }}"
  kube-scheduler-arg:
  - "bind-address={{ k3s_master_ip }}"
  etcd-expose-metrics: "true"
  kube-proxy-arg:
  - "metrics-bind-address=0.0.0.0"

k3s_token: "{{ hostvars[groups['k3s_control_plane'][0]]['token'] }}"

k3s_agent_config:
  kubelet-arg:
  - "kube-reserved=cpu=100m,memory=200Mi"
  - "system-reserved={{ kubelet_system_resources | default('cpu=100m,memory=200Mi') }}"
  - "allowed-unsafe-sysctls=net.ipv4.tcp_adv_win_scale"
  node-label:
  - "network.infra/type={{ network | default('slow') }}"
  - "storage.infra/local={{ 'false' if k3s_no_local_storage is defined else 'true' }}"
  kube-proxy-arg:
  - "metrics-bind-address=0.0.0.0"
  resolv-conf: "/run/systemd/resolve/resolv.conf"

system_earlyoom_params: "-r 60 -m 4"

system_mountpoints:
  - description: k3s data
    before: "k3s.service"
    device: "/dev/disk/by-label/rancher"
    mountpoint: "/var/lib/rancher"
    type: "ext4"
  - description: logs
    before: "local-fs.target"
    device: "/dev/disk/by-label/logs"
    mountpoint: "/var/log"
    type: "ext4"
