---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: harbor
  namespace: harbor
spec:
  interval: 5m
  chart:
    spec:
      chart: harbor
      version: "1.9.0"
      sourceRef:
        kind: HelmRepository
        name: harbor
        namespace: harbor
      interval: 5m
  values:
    expose:
      type: ingress
      ingress:
        hosts:
          core: registry.ankhmorpork.thaum.xyz
          # notary:
        annotations:
          cert-manager.io/cluster-issuer: letsencrypt-prod
          kubernetes.io/ingress.class: nginx
          ingress.kubernetes.io/ssl-redirect: "true"
          ingress.kubernetes.io/proxy-body-size: "0"
          nginx.ingress.kubernetes.io/ssl-redirect: "true"
          nginx.ingress.kubernetes.io/proxy-body-size: "0"
      tls:
        certSource: secret
        secret:
          secretName: harbor-tls 
    externalURL: https://registry.ankhmorpork.thaum.xyz
    persistence:
      persistentVolumeClaim:
        registry:
          storageClass: qnap-nfs-storage
        redis:
          storageClass: local-path
    chartmuseum:
      enabled: false
    trivy:
      enabled: false
    notary:
      enabled: false
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    trace:
      enabled: false
  valuesFrom:
  - kind: Secret
    # Read database.internal.password
    name: harbor-database-config
