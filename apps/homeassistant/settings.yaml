---
common:
  namespace: &namespace "homeassistant"
  externalSecretStoreName: &externalSecretStoreName "doppler-auth-api"
homeassistant:
  version: "2023.4.6"  # application-version-from-github: home-assistant/core
  image: "homeassistant/aarch64-homeassistant:2023.4.6"  # application-image-from-github: home-assistant/core
  namespace: *namespace
  ingress:
    domain: "home.ankhmorpork.thaum.xyz"
    className: 'nginx'
    annotations:
      cert-manager.io/cluster-issuer: 'letsencrypt-prod'
      gethomepage.dev/enabled: "true"
      gethomepage.dev/group: Ankh Cloud
      gethomepage.dev/icon: https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Home_Assistant_Logo.svg/200px-Home_Assistant_Logo.svg.png
      gethomepage.dev/name: HomeAssistant
      gethomepage.dev/description: Home automation system
  hostNetwork: true  # Needed to enable WOL
  timezone: "Europe/Berlin"
  resources:
    # DO NOT DECREASE IT
    # HomeAssistant image has built-in memory management which doesn't propagate to kubernetes
    # this in turn requires to add more resources than it is actually needed
    requests:
      cpu: 700m
      memory: 600Mi
    # limits:
    #   cpu: 2
    #   memory: 1300Mi
  apiTokenRef: "HOMEASSISTANT_PROMETHEUS_TOKEN"
  apiTokenSecretKeySelector:
    name: 'credentials'
    key: 'token'
  externalSecretStoreName: *externalSecretStoreName
  storage:
    name: "homeassistant-config"
    pvcSpec:
      storageClassName: "qnap-nfs"
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
postgres:
  name: postgres
  namespace: *namespace
  db:
    name: homeassistant
    user: homeassistant
    userPassRef: HOMEASSISTANT_DB_PASS
    adminPassRef: HOMEASSISTANT_DB_ADMIN_PASS
  externalSecretStoreName: *externalSecretStoreName
  resources:
    requests:
      cpu: 130m
      memory: 300Mi
    limits:
      cpu: 250m
      memory: 420Mi
  storage:
    size: 1Gi
    storageClass: "qnap-nfs"
esphome:
  version: "2023.3.2"  # application-version-from-github: esphome/esphome
  image: "esphome/esphome:2023.3.2"  # application-image-from-github: esphome/esphome
  namespace: *namespace
  resources:
    requests:
      cpu: 1
      memory: 500Mi
    limits:
      cpu: 1400m
      memory: 1400Mi
  storage:
    name: "esphome-data"
    pvcSpec:
      storageClassName: "qnap-nfs"
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 300Mi
espdevices:
  name: "esp-dev"
  namespace: *namespace
  interval: 60s
  addresses:
  - '192.168.2.221'
  - '192.168.2.222'
  #- '192.168.2.224'
